use cosmwasm_schema::cw_serde;
use kujira::denom::Denom;

use cosmwasm_std::{Addr, Coin, Uint128};
use cw_storage_plus::{Item, Map};

#[cw_serde]
#[serde(rename_all = "snake_case")]
pub struct Config {
    pub entropy_beacon_addr: Addr,
    pub owner_addr: Addr,
    pub house_bankroll: Coin, 
    pub fee_amount: Uint128,
    pub rule_set: RuleSet,
    pub token: Denom,
}

#[cw_serde]
#[serde(rename_all = "snake_case")]
pub struct Game {
    pub player: Addr,
    pub bet_number: u8,
    pub bet_size: Uint128, 
    pub payout: Uint128,
    pub result: Option<Vec<u8>>,
    pub played: bool,
    pub win: Option<bool>,
    pub game_id: Uint128, 
}

impl Game {
    // Cheks if player bet matches the outcome generated by the entropy beacon
    pub fn win(&self, player_bet: u8) -> bool {
        matches!(&self.result, Some(result) if result.contains(&player_bet))
        // match &self.result {
        //     Some(result) if result.contains(&player_bet) => true,
        //     _ => false,
        }
    }


#[cw_serde]
#[serde(rename_all = "snake_case")]
pub struct RuleSet {
    pub zero: Uint128,
    pub one: Uint128,
    pub two: Uint128,
    pub three: Uint128,
    pub four: Uint128,
    pub five: Uint128,
    pub six: Uint128,
}

#[cw_serde]
#[serde(rename_all = "snake_case")]
pub struct EntropyCallbackData {
    pub original_sender: Addr,
}

pub const IDX: Item<Uint128> = Item::new("idx");
pub const GAME: Map<u128, Game> = Map::new("game");
pub const CONFIG: Item<Config> = Item::new("state");
